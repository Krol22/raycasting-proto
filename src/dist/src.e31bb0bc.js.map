{"version":3,"sources":["vector2d.js","inputManager.js","imageData.helper.js","config.js","raycastRenderer.js","index.js","../../../../.config/yarn/global/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["Vector2d","x","y","vector","scalar","Math","sqrt","m","mag","div","angle","inRadians","PI","cos","sin","v0","v1","v2","pow","a","b","c","delta","acos","restartKeyState","key","isPressed","wasPressed","isDown","InputManager","_canvas","keys","mouseState","pos","posInCanvas","prevPos","mouse1","mouse2","init","canvasSelector","document","querySelector","_initKeyBoardEvents","_initMouseEvents","i","update","Object","forEach","keyCode","window","addEventListener","e","boundingRect","getBoundingClientRect","floor","clientX","clientY","button","getImageDataFromImage","image","canvas","createElement","ctx","getContext","width","height","imageSmoothingEnabled","drawImage","getImageData","copyPixel","sourceImageData","sx","sy","ssize","destImageData","dx","dy","dsize","alpha","sourceIndex","destIndex","addPixelToImageData","sourceData","dest","data","resolutionWidth","resolutionHeight","playerMovementSpeed","viewSkipDistance","viewDistance","viewDistanceObjectFix","viewDistanceWallFix","cameraMinY","cameraMaxY","textureSize","mapValue","input","d","RaycastRenderer","rayCastingImageData","ImageData","camera","planeX","planeY","lookY","pointingAt","playerPosition","rayDir","walls","hitWalls","length","texture","x1","y1","x2","y2","x3","y3","x4","y4","den","t","u","mapPos","len","magnitude","push","id","side","type","player","objects","position","dir","sortedObjects","texWidth","texHeight","sort","obj1","obj2","len2","obj","uDiv","vDiv","vMove","spriteX","spriteY","invDet","transformX","transformY","spriteScreenX","vMoveScreen","spriteHeight","abs","drawStartY","drawEndY","spriteWidth","drawStartX","drawEndX","element","ray","perpWallDist","drawStart","currentDist","weight","currentFloorX","currentFloorY","floorTexX","floorTexY","floorImageData","drawEnd","celingImageData","object","texX","texY","wall","isClosestWall","lineHeight","wallX","textureX","offsetDS","offsetDE","mapValueMin","mapValueMax","textureY","drawFloor","drawCeling","cameraX","castRays","visibleObjects","filter","elementsToDraw","elem1","elem2","lastElementIndex","index","drawWall","drawObject","clearRect","preparedObjects","prepareObjectToDraw","draw","putImageData","fillStyle","fillRect","pointingAtSpan","pointing","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","raycastRenderer","getCamera","mouseMove","movementY","rotSpeed","movementX","oldDirX","oldPlaneX","pointerlockvalue","removeEventListener","requestPointerLock","playerMovement","loop","innerHTML","requestAnimationFrame","loadAsset","src","console","log","Promise","resolve","asset","Image","onload","onerror","err","then","wallImageData","ammoImageData","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","event","JSON","parse","handled","assets","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","body","appendChild","getElementById","remove","stackTrace","innerText","getParents","modules","parents","k","dep","Array","isArray","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"src.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export default class Vector2d {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  add(vector) {\n    this.x += vector.x;\n    this.y += vector.y;\n  }\n\n  static addVectors(v0, v1) {\n    return new Vector2d(v0.x + v1.x, v0.y + v1.y);\n  }\n\n  sub(vector) {\n    this.x -= vector.x;\n    this.y -= vector.y;\n  }\n\n  mul(scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n  }\n\n  div(scalar) {\n    this.x /= scalar;\n    this.y /= scalar;\n  }\n\n  mag() {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  }\n\n  normalize() {\n    const m = this.mag();\n    this.div(m);\n  }\n\n  rotateAroundVector(vector, angle, inRadians) {\n    if (inRadians) {\n        angle = angle * (180 / Math.PI);\n    }\n\n    let { x, y } = this;\n\n    x -= vector.x;\n    y -= vector.y\n\n    this.x = x * Math.cos(angle) - y * Math.sin(angle);\n    this.y = y * Math.cos(angle) + x * Math.sin(angle);\n\n    this.x += vector.x;\n    this.y += vector.y;\n  }\n\n  static magnitude(v1, v2) {\n    return Math.sqrt(\n      Math.pow(v1.x - v2.x, 2) + Math.pow(v1.y - v2.y, 2)\n    );\n  }\n\n  static findAngle(v0, v1, v2) {\n    let a = Math.pow(v1.x - v0.x, 2) + Math.pow(v1.y - v0.y, 2);\n    let b = Math.pow(v1.x - v2.x, 2) + Math.pow(v1.y - v2.y, 2);\n    let c = Math.pow(v2.x - v0.x, 2) + Math.pow(v2.y - v0.y, 2);\n\n    let delta = (a + b - c) / Math.sqrt(4 * a * b);\n    let angle = Math.acos(delta);\n\n    if (delta < -1) {\n      return Math.PI;\n    } else if (delta > 1) {\n      return 0;\n    }\n\n    if (v0.y > v1.y) {\n      angle = 2 * Math.PI - angle;\n    }\n\n    return angle;\n  }\n}\n","import Vector2d from './vector2d';\n\nconst restartKeyState = key => {\n    key.isPressed = false;\n    key.wasPressed = false;\n    key.isDown = false;\n};\n\nexport const InputManager = {\n    _canvas: null,\n    keys: {},\n    mouseState: {\n        pos: new Vector2d(0, 0),\n        posInCanvas: new Vector2d(0, 0),\n        prevPos: new Vector2d(0, 0),\n        mouse1: false,\n        mouse2: false\n    },\n    init (canvasSelector) {\n        this._canvas = document.querySelector(canvasSelector);\n\n        this._initKeyBoardEvents();\n        this._initMouseEvents();\n\n        for(let i = 0; i < 255; i++) {\n            this.keys[i] = {\n                isPressed: false,\n                wasPressed: false,\n                isDown: false,\n            }\n        }\n    },\n    update() {\n        Object.keys(this.keys).forEach(keyCode => {\n            if (this.keys[keyCode].wasPressed) {\n                this.keys[keyCode].isDown = true;\n                this.keys[keyCode].isPressed = false;\n            }\n\n            if (!this.keys[keyCode].isDown) {\n                this.keys[keyCode].wasPressed = this.keys[keyCode].isPressed;\n            }\n        });\n    },\n    _initKeyBoardEvents () {\n        window.addEventListener('keydown', (e) => {\n            if (!this.keys[e.keyCode]) {\n                this.keys[e.keyCode] = {\n                    isPressed: true,\n                    wasPressed: false,\n                    isDown: false\n                };\n\n                return;\n            } else {\n                this.keys[e.keyCode].isDown = true;\n            }\n\n            if (!this.keys[e.keyCode].isDown) {\n                this.keys[e.keyCode].isPressed = true;\n            }\n        });\n\n        window.addEventListener('keyup', (e) => {\n            restartKeyState(this.keys[e.keyCode]);\n        });\n    },\n    _initMouseEvents () {\n        window.addEventListener('mousemove', (e) => {\n            const boundingRect = this._canvas.getBoundingClientRect();\n\n            const pos = new Vector2d(Math.floor(e.clientX), Math.floor(e.clientY));\n            const posInCanvas = new Vector2d(pos.x - Math.floor(boundingRect.x), pos.y - Math.floor(boundingRect.y));\n\n            this.mouseState.prevPos = this.mouseState.pos;\n\n            this.mouseState.pos = pos;\n            this.mouseState.posInCanvas = posInCanvas;\n        });\n\n        // #TODO: finish after getting normal mouse\n        window.addEventListener('mousedown', (e) => {\n            if (e.button === 0) {\n                this.mouseState.mouse1 = true;\n            }\n\n            if (e.button === 2) {\n                this.mouseState.mouse2 = true;\n            }\n        });\n\n        window.addEventListener('mouseup', (e) => {\n            if (e.button === 0) {\n                this.mouseState.mouse1 = false;\n            }\n\n            if (e.button === 2) {\n                this.mouseState.mouse2 = false;\n            }\n        });\n    }\n}\n","export const getImageDataFromImage = image => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  canvas.width = image.width;\n  canvas.height = image.height;\n\n  ctx.imageSmoothingEnabled = false;\n  ctx.drawImage(image, 0, 0);\n  return ctx.getImageData(0, 0, image.width, image.height);\n}\n\nexport const copyPixel = (sourceImageData, sx, sy, ssize, destImageData, dx, dy, dsize, alpha) => {\n  const sourceIndex = ((Math.floor(sy) * ssize) + Math.floor(sx)) * 4;\n  const destIndex = ((Math.floor(dy) * dsize) + Math.floor(dx)) * 4;\n\n  addPixelToImageData(sourceImageData, sourceIndex, destImageData, destIndex, alpha);\n}\n\nfunction addPixelToImageData(sourceData, sourceIndex, dest, destIndex, alpha) {\n  if(!sourceData.data[sourceIndex + 3]) { return; }\n\n  dest.data[destIndex] = sourceData.data[sourceIndex];\n  dest.data[destIndex + 1] = sourceData.data[sourceIndex + 1];\n  dest.data[destIndex + 2] = sourceData.data[sourceIndex + 2];\n  dest.data[destIndex + 3] = sourceData.data[sourceIndex + 3];\n\n  if (alpha) {\n    dest.data[destIndex + 3] = alpha;\n    return;\n  }\n}\n\nexport default {\n  copyPixel,\n  getImageDataFromImage\n}\n","export const resolutionWidth = 800;\nexport const resolutionHeight = 600;\nexport const playerMovementSpeed = 0.1;\nexport const viewSkipDistance = 14;\nexport const viewDistance = 14;\nexport const viewDistanceObjectFix = 1.5;\nexport const viewDistanceWallFix = 1.5;\nexport const cameraMinY = -300;\nexport const cameraMaxY = 200;\n","import Vector2d from './vector2d';\n\nimport { copyPixel } from './imageData.helper';\nimport { \n  resolutionWidth, \n  resolutionHeight,\n  viewDistance,\n  viewDistanceWallFix,\n  viewDistanceObjectFix,\n} from './config';\n\n/*\n  TODO:\n  1. Fix performance on floor and celing, \n     max number of iterations should be \n     resolutionWidth * resolutionHeight \n     but it's goes above this number,\n*/\n\nconst textureSize = 16;\n\nconst mapValue = (input, a, b, c, d) => {\n  return c + ((d - c) / (b - a)) * (input - a);\n};\n\nexport default class RaycastRenderer {\n  constructor(ctx) {\n    this.ctx = ctx;\n    this.rayCastingImageData = new ImageData(resolutionWidth, resolutionHeight);\n    this.camera = {\n      planeX: 0.62,\n      planeY: 0.66,\n      lookY: 0,\n      pointingAt: '',\n    };\n  }\n\n  getCamera() {\n    return this.camera;\n  }\n\n  castRays(playerPosition, rayDir, walls) {\n    const hitWalls = [];\n\n    for (let i = 0; i < walls.length; i++) {\n      const { v1, v2, height, texture } = walls[i];\n\n      const x1 = v1.x;\n      const y1 = v1.y;\n      const x2 = v2.x;\n      const y2 = v2.y;\n\n      const x3 = playerPosition.x;\n      const y3 = playerPosition.y;\n\n      const x4 = playerPosition.x + rayDir.x;\n      const y4 = playerPosition.y + rayDir.y;\n\n      const den = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n      if (den === 0) { \n        continue;\n      }\n\n      const t = ((x1 - x3) * (y3 - y4) - (y1 - y3) * (x3 - x4)) / den;\n      const u = - ((x1 - x2) * (y1 - y3) - (y1 - y2) * (x1 - x3)) / den;\n\n      if (t <= 0 || t >= 1 || u <= 0) {\n        continue;\n      }\n\n      const mapPos = new Vector2d(x1 + t * (x2 - x1), y1 + t * (y2 - y1));\n      const len = Vector2d.magnitude(mapPos, playerPosition);\n\n      hitWalls.push({\n        id: 4,\n        side: 0,\n        len,\n        mapPos,\n        height,\n        texture,\n        type: 'WALL',\n      });\n    }\n\n    return [hitWalls];\n  }\n\n  prepareObjectToDraw(player, objects) {\n    const { position, dir } = player;\n    const { planeX, planeY, lookY } = this.camera;\n\n    const sortedObjects = [];\n\n    const texWidth = 16;\n    const texHeight = 16;\n\n    objects.sort((obj1, obj2) => {\n      const len = Vector2d.magnitude(obj1.pos, position);\n      const len2 = Vector2d.magnitude(obj2.pos, position);\n\n      return len2 - len;\n    }).forEach(obj => {\n      const { uDiv = 1, vDiv = 1, vMove = 0 } = obj;\n\n      const spriteX = obj.pos.x - position.x;\n      const spriteY = obj.pos.y - position.y;\n\n      const invDet = 1 / (planeX * dir.y - dir.x * planeY);\n      const transformX = invDet * (dir.y * spriteX - dir.x * spriteY);\n      const transformY = invDet * (- planeY * spriteX + planeX * spriteY);\n\n      const len = Vector2d.magnitude(obj.pos, position);\n\n      const spriteScreenX = Math.floor((resolutionWidth / 2) * (1 + transformX / transformY));\n\n      const vMoveScreen = Math.floor(vMove / transformY) + lookY;\n\n      const spriteHeight = Math.abs(Math.floor(resolutionHeight / transformY)) / vDiv;\n\n      let drawStartY = -spriteHeight / 2 + resolutionHeight / 2 + vMoveScreen;\n      if (drawStartY < 0 - lookY) drawStartY = 0;\n      let drawEndY = spriteHeight / 2 + resolutionHeight / 2 + vMoveScreen;\n      if (drawEndY >= resolutionHeight - lookY) drawEndY = resolutionHeight - 1;\n\n      const spriteWidth = Math.abs(Math.floor(resolutionHeight / transformY)) / uDiv;\n      let drawStartX = -spriteWidth / 2 + spriteScreenX;\n      if (drawStartX < 0) drawStartX = 0;\n      let drawEndX = spriteWidth / 2 + spriteScreenX;\n      if (drawEndX >= resolutionWidth) drawEndX = resolutionHeight - 1;\n\n      sortedObjects.push({\n        drawStartX: Math.floor(drawStartX),\n        drawEndX: Math.floor(drawEndX),\n        drawStartY,\n        drawEndY,\n        vMoveScreen,\n        obj,\n        len,\n        spriteScreenX, \n        spriteWidth,\n        spriteHeight,\n        transformY,\n        texWidth,\n        texHeight,\n        type: 'OBJECT',\n      });\n\n    });\n\n    return sortedObjects;\n  }\n\n  drawFloor(player, element, ray, x) {\n    const { mapPos } = element;\n    const { position } = player;\n    const { perpWallDist, drawStart } = ray;\n\n    for (let y = drawStart; y < resolutionHeight - this.camera.lookY; y++) {\n      const currentDist = resolutionHeight / (2 * y - resolutionHeight);\n\n      const weight = currentDist / perpWallDist;\n\n      const currentFloorX = (weight * mapPos.x + (1 - weight) * position.x);\n      const currentFloorY = (weight * mapPos.y + (1 - weight) * position.y);\n\n      const floorTexX = ~~(currentFloorX * textureSize) % textureSize;\n      const floorTexY = ~~(currentFloorY * textureSize) % textureSize;\n\n      const alpha = mapValue(currentDist, 0, viewDistance, 255, 0);\n\n      copyPixel(window.floorImageData, floorTexX, floorTexY, textureSize, this.rayCastingImageData, x, y + this.camera.lookY, resolutionWidth, alpha);\n    }\n  }\n\n  drawCeling(player, element, ray, x) {\n    const { mapPos } = element;\n    const { position } = player;\n    const { perpWallDist, drawEnd } = ray;\n\n    if (drawEnd < 0) {\n      return;\n    }\n\n    for (let y = 0 - this.camera.lookY; y < drawEnd; y++) {\n      const currentDist = resolutionHeight / (resolutionHeight - 2 * y);\n      const weight = currentDist / perpWallDist;\n\n      const currentFloorX = (weight * mapPos.x + (1 - weight) * position.x);\n      const currentFloorY = (weight * mapPos.y + (1 - weight) * position.y);\n\n      const floorTexX = ~~(currentFloorX * textureSize) % textureSize;\n      const floorTexY = ~~(currentFloorY * textureSize) % textureSize;\n\n      const alpha = mapValue(currentDist, 0, viewDistance, 255, 0);\n\n      copyPixel(window.celingImageData, floorTexX, floorTexY, textureSize, this.rayCastingImageData, x, y + this.camera.lookY, resolutionWidth, alpha);\n    }\n  }\n\n\n  drawObject(object, x) {\n    const {\n      drawStartY,\n      drawEndY,\n      vMoveScreen,\n      spriteScreenX, \n      spriteWidth,\n      spriteHeight,\n      transformY,\n      texWidth,\n      texHeight,\n      obj,\n      len,\n    } = object;\n\n    const alpha = mapValue(len, 0, viewDistance * viewDistanceObjectFix, 254, 0);\n\n    const texX = Math.floor(256 * (x - (-spriteWidth / 2 + spriteScreenX)) * texWidth / spriteWidth) / 256;\n    if (transformY > 0) {\n      for(let y = Math.floor(drawStartY); y < drawEndY; y++) {\n        if (x === resolutionWidth / 2 && y === resolutionHeight / 2) {\n          this.camera.pointingAt = obj.type;  \n        }\n        const d = (y - vMoveScreen) * 256 - resolutionHeight * 128 + spriteHeight * 128;\n        const texY = ((d * texHeight) / spriteHeight) / 256;\n\n        copyPixel(obj.texture, texX, texY, textureSize, this.rayCastingImageData, x, y, resolutionWidth, alpha);\n      }\n    }\n  }\n\n  drawWall(player, wall, x, rayDir, isClosestWall) {\n    const { position } = player;\n\n    const ray = {};\n    ray.dir = rayDir;\n\n    let { mapPos, texture } = wall;\n\n    ray.perpWallDist = (mapPos.x - position.x) / ray.dir.x;\n\n    let lineHeight = Math.floor(Math.abs(resolutionHeight / ray.perpWallDist));\n\n    ray.drawStart = (resolutionHeight + lineHeight) / 2;\n    ray.drawEnd = ray.drawStart - lineHeight;\n\n    let wallX = position.y + ray.perpWallDist * ray.dir.y;\n    wallX += position.x + ray.perpWallDist * ray.dir.x;\n    wallX -= Math.floor(wallX);\n\n    const textureX = Math.floor((wallX - Math.floor(wallX)) * textureSize);\n\n    let offsetDS = 0;\n    if (ray.drawStart > resolutionHeight) {\n      offsetDS = ray.drawStart;\n      ray.drawStart = resolutionHeight;\n    }\n\n    let offsetDE = 0;\n    if (ray.drawEnd < 0) {\n      offsetDE = ray.drawEnd;\n      ray.drawEnd = 0;\n    }\n\n    lineHeight = ray.drawStart - ray.drawEnd;\n    lineHeight;\n\n    let mapValueMin = offsetDE ? offsetDE : 0;\n    let mapValueMax = offsetDS ? offsetDS : lineHeight;\n\n    const alpha = mapValue(Vector2d.magnitude(position, mapPos), 0, viewDistance * viewDistanceWallFix, 255, 0);\n\n    for (let i = this.camera.lookY < 0 ? this.camera.lookY : 0; i < lineHeight + (this.camera.lookY > 0 ? this.camera.lookY : 0); i++) {\n      const textureY = Math.floor(\n        mapValue(i,\n          mapValueMin,\n          mapValueMax,\n          0,\n          textureSize\n        )\n      );\n\n      copyPixel(texture, textureX, textureY, textureSize, this.rayCastingImageData, Math.floor(x), Math.floor(ray.drawStart - i + this.camera.lookY), resolutionWidth, alpha);\n    }\n\n    if (isClosestWall) {\n      this.drawFloor(player, wall, ray, x);\n      this.drawCeling(player, wall, ray, x);\n    }\n  }\n\n  draw(player, walls, objects) {\n    const { position, dir } = player;\n\n    for (let x = 0; x < resolutionWidth; x++) {\n      const cameraX = 2 * x / resolutionWidth - 1; \n      const rayDir = new Vector2d(dir.x + this.camera.planeX * cameraX, dir.y + this.camera.planeY * cameraX);\n\n      const [hitWalls] = this.castRays(position, rayDir, walls);\n      const visibleObjects = objects.filter(({ drawStartX, drawEndX }) => {\n        return drawStartX < x && x < drawEndX; \n      });\n\n      const elementsToDraw = [...hitWalls, ...visibleObjects].sort((elem1, elem2) => elem2.len - elem1.len);\n\n      let lastElementIndex = 0;\n      for (let i = elementsToDraw.length - 1; i > 0; i--) {\n        if (elementsToDraw[i].type === 'WALL') {\n          lastElementIndex = i;\n          break;\n        }\n      }\n\n      elementsToDraw.forEach((element, index) => {\n        if (element.type === 'WALL') {\n          this.drawWall(player, element, x, rayDir, lastElementIndex === index);\n          return;\n        }\n\n        if (element.type === 'OBJECT') {\n          this.drawObject(element, x);\n          return;\n        }\n      });\n    }\n  }\n\n  update(player, objects, walls) {\n    this.camera.pointingAt = 'WORLD';\n    this.rayCastingImageData = new ImageData(resolutionWidth, resolutionHeight);\n    this.ctx.clearRect(0, 0, 800, 400);\n    const preparedObjects = this.prepareObjectToDraw(player, objects);\n    this.draw(player, walls, preparedObjects);\n\n    this.ctx.putImageData(this.rayCastingImageData, 0, 0);\n    this.ctx.fillStyle = 'red';\n    this.ctx.fillRect(\n      resolutionWidth / 2 - 2,\n      resolutionHeight / 2 - 2,\n      2,\n      2,\n    );\n  }\n}\n\n","import Vector2d from './vector2d';\nimport {InputManager} from './inputManager';\n\nimport {getImageDataFromImage} from './imageData.helper';\nimport {playerMovementSpeed, cameraMinY, cameraMaxY} from './config';\nimport RaycastRenderer from './raycastRenderer';\n\nconst pointingAtSpan = document.querySelector('#pointing-at');\n\nconst player = {\n  position: new Vector2d(20, 20),\n  dir: new Vector2d(1, -1),\n  pointing: 'nothing',\n};\n\nconst walls = [\n  {\n    v1: new Vector2d(30, 0),\n    v2: new Vector2d(30, 30),\n  },\n  {\n    v1: new Vector2d(30, 30),\n    v2: new Vector2d(0, 30),\n  },\n  {\n    v1: new Vector2d(20, 20),\n    v2: new Vector2d(0, 20),\n  },\n\n  {\n    v1: new Vector2d(10, 10),\n    v2: new Vector2d(0, 10),\n  },\n  {\n    v1: new Vector2d(0, 30),\n    v2: new Vector2d(0, 0),\n  },\n  {\n    v1: new Vector2d(0, 0),\n    v2: new Vector2d(30, 0),\n  },\n];\n\nconst objects = [\n  {\n    id: 0,\n    pos: new Vector2d(15, 15),\n    type: 'AMMO',\n    vMove: -160,\n    uDiv: 4,\n    vDiv: 4\n  },\n  {\n    id: 1,\n    pos: new Vector2d(25, 17),\n    type: 'AMMO',\n    vMove: 160,\n    uDiv: 4,\n    vDiv: 4\n  },\n  {\n    id: 2,\n    pos: new Vector2d(5, 15),\n    type: 'AMMO',\n    vMove: 0,\n    uDiv: 4,\n    vDiv: 4\n  },\n];\n\nconst canvas = document.querySelector('#game-canvas');\nconst ctx = canvas.getContext('2d');\nctx.webkitImageSmoothingEnabled = false;\nctx.mozImageSmoothingEnabled = false;\nctx.imageSmoothingEnabled = false;\n\nconst raycastRenderer = new RaycastRenderer(ctx);\nconst camera = raycastRenderer.getCamera();\n\nconst mouseMove = e => {\n  if (\n    e.movementY > 0 && camera.lookY > cameraMinY ||\n    e.movementY < 0 && camera.lookY < cameraMaxY\n  ) {\n    camera.lookY -= e.movementY;\n  }\n\n  const rotSpeed = e.movementX / 1000;\n\n  const oldDirX = player.dir.x;\n  player.dir.x = player.dir.x * Math.cos(rotSpeed) - player.dir.y * Math.sin(rotSpeed);\n  player.dir.y = oldDirX * Math.sin(rotSpeed) + player.dir.y * Math.cos(rotSpeed);\n\n  const oldPlaneX = camera.planeX;\n  camera.planeX = camera.planeX * Math.cos(rotSpeed) - camera.planeY * Math.sin(rotSpeed);\n  camera.planeY = oldPlaneX * Math.sin(rotSpeed) + camera.planeY * Math.cos(rotSpeed);\n}\n\nlet pointerlockvalue = false;\ndocument.addEventListener('pointerlockchange', () => {\n  pointerlockvalue = !pointerlockvalue;\n\n  if (pointerlockvalue) {\n    canvas.addEventListener('mousemove', mouseMove);\n  } else {\n    canvas.removeEventListener('mousemove', mouseMove);\n  }\n});\n\ncanvas.addEventListener('mousedown', () => {\n  canvas.requestPointerLock();\n})\n\nInputManager.init('#game-canvas');\n\nconst playerMovement = () => {\n  if (InputManager.keys[87] && InputManager.keys[87].isDown) {\n    player.position.y += player.dir.y * playerMovementSpeed;\n    player.position.x += player.dir.x * playerMovementSpeed;\n  }\n\n  if (InputManager.keys[83] && InputManager.keys[83].isDown) {\n    player.position.y -= player.dir.y * playerMovementSpeed;\n    player.position.x -= player.dir.x * playerMovementSpeed;\n  }\n\n};\n\nconst loop = () => {\n  playerMovement();\n  raycastRenderer.update(player, objects, walls);\n  pointingAtSpan.innerHTML = `${raycastRenderer.getCamera().pointingAt}`;\n  window.requestAnimationFrame(loop);\n};\n\nconst loadAsset = src => {\n  console.log(src);\n  return new Promise(resolve => {\n    console.log('test123')\n    const asset = new Image();\n    asset.src = src;\n    asset.onload = () => {\n      resolve(asset);\n    }\n\n    asset.onerror = (err) => {\n      console.log(err);\n    }\n  });\n};\n\nconsole.log(\"test\")\n\nloadAsset('./Wall.png').then(asset => {\n  console.log(\"test123\");\n  const wallImageData = getImageDataFromImage(asset);\n  walls.forEach(wall => wall.texture = wallImageData);\n  return loadAsset('Floor.png')\n}).then(asset => {\n  window.floorImageData = getImageDataFromImage(asset);\n  return loadAsset('Celling.png')\n}).then(asset => {\n  window.celingImageData = getImageDataFromImage(asset);\n  return loadAsset('Ammo.png')\n}).then(asset => {\n  const ammoImageData = getImageDataFromImage(asset);\n  objects.forEach(object => {object.texture = ammoImageData})\n  window.requestAnimationFrame(loop);\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else {\n        window.location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}